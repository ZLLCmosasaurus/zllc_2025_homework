## HomeWork2.1.2

### SPI通信 与 BMI088协议手册

SPI通信协议：https://blog.csdn.net/as480133937/article/details/105849607  

BMI088的使用：https://blog.csdn.net/asdashhv/article/details/124413960  
  
数据手册：https://item.szlcsc.com/datasheet/BMI088/239391.html

四元数解算（Mahony）：https://blog.csdn.net/lqj11/article/details/107423334 

卡尔曼滤波 ：https://blog.csdn.net/qqliuzhitong/article/details/118337049



**注意点**
1. **SPI通信协议**  
* SPI只有主模式和从模式之分，没有读和写的说法，外设的写操作和读操作是同步完成的。如果只进行写操作，主机只需忽略接收到的字节；反之，若主机要读取从机的一个字节，就必须发送一个空字节来引发从机的传输。也就是说，你发一个数据必然会收到一个数据；你要收一个数据必须也要先发一个数据。  
    
* SPI工作模式  
根据时钟极性（CPOL）及相位（CPHA）不同，SPI有四种工作模式。

  时钟极性(CPOL)定义了时钟空闲状态电平：  
  >CPOL=0为时钟空闲时为低电平  
  >CPOL=1为时钟空闲时为高电平 

  时钟相位(CPHA)定义数据的采集时间。 

  >CPHA=0:在时钟的第一个跳变沿进行数据采样。  
  >CPHA=1:在时钟的第二个跳变沿进行数据采样。  
  
  这需要根据对应模块工作模式决定。  

  空闲状态决定什么时候可以写入数据，以及初始电平，也就影响了CPHA的采样电平到底是上升沿还是下降沿。  

  数据采样是在对应边沿跳变后那段时间开始采样，直到另一个边沿跳变产生。


### IMU姿态解算和卡尔曼滤波

1. **四元数数据处理基本思路**   
   * 将罗德里格旋转公式转换为四元数的形式，经过一系列变换，可得到用四元数表示的旋转公式。 
   
   * 带入四元数的左乘右乘矩阵，得到用四元数表示的旋转矩阵
  
   * 与欧拉角表示的旋转矩阵相照应，即得到相应的姿态角
  
   * 四元数的更新： 根据Mahony算法，应该用加速度陀螺仪补偿误差值最后带入由角速度决定的转移公式。  
   
   * 因此，我们并不需要按罗德里格旋转公式实时考虑旋转轴的选取，只需要给定初始1，0，0，0，让更新公式自动更新即可。
   
   * 不了解用EKF的方法，以上只是大体处理流程。

2. **卡尔曼滤波基础**  
   *  公式推导，只需大体理解参数含义与滤波思路：[请看VCR：DR_CAN](https://www.bilibili.com/video/BV1ez4y1X7eR?spm_id_from=333.788.videopod.sections&vd_source=de144ef193dc3f4b419bd8828397d9db)
   
   *  理解后推导对应参数and代公式
  
   *  没看EKF